<!DOCTYPE HTML>
<html lang="en">
<head>
<title>Release Countdown</title>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="language" content="en">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="preload" href="/fonts/titillium-web-v9-latin-200.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/titillium-web-v9-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/titillium-web-v9-latin-600.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/titillium-web-v9-latin-200.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="/fonts/titillium-web-v9-latin-regular.woff" as="font" type="font/woff" crossorigin>
<link rel="preload" href="/fonts/titillium-web-v9-latin-600.woff" as="font" type="font/woff" crossorigin>
<meta name="description" content="A release countdown for teams that want to track the remaining time for something to be published. Also usable for other countdown needs...">
<meta name="page-topic" content="A Countdown Web-App">
<meta name="page-type" content="website">
<meta name="author" content="https://github.com/manuelfeller">
<meta name="publisher" content="https://github.com/manuelfeller">
<meta name="copyright" content="https://github.com/manuelfeller">
<meta name="audience" content="all">
<meta name="robots" content="INDEX, FOLLOW">
<meta name="generator" content="Handwritten VS Code">
<meta property="og:title" content="Manu's Release Countdown" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://countdown.devsvr.ws/" />
<meta property="og:image" content="https://countdown.devsvr.ws/images/screenshot.png" />
<meta property="og:image:secure_url" content="https://countdown.devsvr.ws/images/screenshot.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content="A screenshot of the countdown, taken in dark mode..." />
<meta property="og:locale" content="en-US" />
<meta property="og:description" content="A release countdown for teams that want to track the remaining time for something to be published. Also usable for other countdown needs..." />
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@manuelfeller">
<meta name="twitter:title" content="Manu's (BI X) Release Countdown">
<meta name="twitter:description" content="A release countdown for teams that want to track the remaining time for something to be published. Also usable for other countdown needs...">
<meta name="twitter:image" content="https://countdown.devsvr.ws/images/screenshot.png">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" href="/images/icon-32.png" type="image/png">
<link rel="apple-touch-icon" sizes="48x48" href="/images/icon-48.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/icon-72.png">
<link rel="apple-touch-icon" sizes="96x96" href="/images/icon-96.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/icon-144.png">
<link rel="apple-touch-icon" sizes="192x192" href="/images/icon-192.png">
<link rel="apple-touch-icon" sizes="256x256" href="/images/icon-256.png">
<link rel="apple-touch-icon" sizes="384x384" href="/images/icon-384.png">
<link rel="apple-touch-icon" sizes="512x512" href="/images/icon-512.png">
<link rel="apple-touch-icon" sizes="57x57" href="/images/icon-57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/images/icon-60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/icon-72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/icon-76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/icon-114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/icon-120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/icon-144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/icon-152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/icon-180.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/icon-16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/icon-32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/images/icon-96.png">
<link rel="icon" type="image/png" sizes="192x192" href="/images/icon-192.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#dddade">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="white">
<meta name="msapplication-TileImage" content="/images/icon-144.png">
<meta name="msapplication-TileColor" content="#dddade">
<style>
/* titillium-web-200 - latin */
@font-face {
  font-family: 'Titillium Web';
  font-style: normal;
  font-weight: 200;
  font-display: swap;
  src: url('fonts/titillium-web-v9-latin-200.eot'); /* IE9 Compat Modes */
  src: local(''),
       url('fonts/titillium-web-v9-latin-200.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
       url('fonts/titillium-web-v9-latin-200.woff2') format('woff2'), /* Super Modern Browsers */
       url('fonts/titillium-web-v9-latin-200.woff') format('woff'), /* Modern Browsers */
       url('fonts/titillium-web-v9-latin-200.ttf') format('truetype'), /* Safari, Android, iOS */
       url('fonts/titillium-web-v9-latin-200.svg#TitilliumWeb') format('svg'); /* Legacy iOS */
}
/* titillium-web-regular - latin */
@font-face {
  font-family: 'Titillium Web';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url('fonts/titillium-web-v9-latin-regular.eot'); /* IE9 Compat Modes */
  src: local(''),
       url('fonts/titillium-web-v9-latin-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
       url('fonts/titillium-web-v9-latin-regular.woff2') format('woff2'), /* Super Modern Browsers */
       url('fonts/titillium-web-v9-latin-regular.woff') format('woff'), /* Modern Browsers */
       url('fonts/titillium-web-v9-latin-regular.ttf') format('truetype'), /* Safari, Android, iOS */
       url('fonts/titillium-web-v9-latin-regular.svg#TitilliumWeb') format('svg'); /* Legacy iOS */
}
/* titillium-web-600 - latin */
@font-face {
  font-family: 'Titillium Web';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: url('fonts/titillium-web-v9-latin-600.eot'); /* IE9 Compat Modes */
  src: local(''),
       url('fonts/titillium-web-v9-latin-600.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
       url('fonts/titillium-web-v9-latin-600.woff2') format('woff2'), /* Super Modern Browsers */
       url('fonts/titillium-web-v9-latin-600.woff') format('woff'), /* Modern Browsers */
       url('fonts/titillium-web-v9-latin-600.ttf') format('truetype'), /* Safari, Android, iOS */
       url('fonts/titillium-web-v9-latin-600.svg#TitilliumWeb') format('svg'); /* Legacy iOS */
}

/* variables */
:root {
  --bgGradientStart: rgb(234,234,234);
  --bgGradientEnd: rgb(210,210,210);
  --mainTextColor: #333;
  --cntElementBackground: #eee;
  --cntNumberTextColor: #fff;
  --btnBackgroundColor: #ddd;
  --btnDisabledTextColor: #888;
  --logoManuColor: #000;
}

/* page styles */
* {
  padding: 0;
  margin: 0;
  font-family: "Titillium Web",sans-serif;
}
html {
  height: 100%;
}
body {
  color: var(--mainTextColor);
  text-align: center;
  background-color: var(--bgGradientStart);
  background: linear-gradient(-45deg, var(--bgGradientStart) 0%, var(--bgGradientEnd) 100%);
  font-weight: 200;
  height: 100%;
}
h1 {
  color: var(--mainTextColor);
  font-size: 6vw;
  font-weight: 400;
}
h2 {
  color: var(--mainTextColor);
  font-size: 4vw;
  font-weight: 400;
}
label {
  font-size: 2vw;
}
input {
  font-size: 2vw;
  padding-left: 0.5vw;
  padding-right: 0.5vw;
  border-radius: 1vh;
}
button {
  font-size: 2vw;
  padding-left: 0.5vw;
  padding-right: 0.5vw;
  border-radius: 1vh;
  color: var(--mainTextColor);
  background-color: var(--btnBackgroundColor);
}
button:disabled {
  color: var(--btnDisabledTextColor);
  border: 0px;
}

#clockdiv {
  font-family: sans-serif;
  color: var(--mainTextColor);
  display: inline-block;
  text-align: center;
  font-size: 3vw;
}
#clockdiv > div {
  border-radius: 1vh;
  background-color: var(--cntElementBackground);
  display: inline-block;
  width: 20vw;
  padding-bottom: 1vh;
}
#clockdiv div > span {
  padding-top: 2vh;
  padding-bottom: 2vh;
  border-radius: 1vh;
  margin-bottom: 1vh;
  font-size: 5vw;
  font-weight: 600;
  width: 100%;
  background-color: #444; /* fixed color as this does not change in light / dark mode */
  background-image: url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='none' viewBox='0 0 1 1' version='1.1' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='g'%3E%3Cstop offset='0' stop-color='%23fff' stop-opacity='0'%3E%3C/stop%3E%3Cstop offset='1' stop-color='%23fff' stop-opacity='1'%3E%3C/stop%3E%3C/linearGradient%3E%3Cmask id='m'%3E%3Crect x='0' y='0' width='1' height='1' fill='url(%23g)'%3E%3C/rect%3E%3C/mask%3E%3ClinearGradient id='a' gradientTransform='rotate(90)'%3E%3Cstop offset='0' stop-color='%2375B843'%3E%3C/stop%3E%3Cstop offset='1' stop-color='%23E71C77'%3E%3C/stop%3E%3C/linearGradient%3E%3ClinearGradient id='b' gradientTransform='rotate(90)'%3E%3Cstop offset='0' stop-color='%23003D7C'%3E%3C/stop%3E%3Cstop offset='1' stop-color='%2334AED6'%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect x='0' y='0' width='1' height='1' fill='url(%23a)' mask='url(%23m)'%3E%3C/rect%3E%3Crect x='0' y='0' width='1' height='1' fill='url(%23b)' mask='url(%23m)' transform='translate(1,1) rotate(180)'%3E%3C/rect%3E%3C/svg%3E");
  background-size: 100% 100%;
  color: var(--cntNumberTextColor);
  display: inline-block;
}
.smalltext {
  font-weight: 400;
}
.finishedText {
  font-size: 5vw;
}

.setupContainer {
  overflow-y: auto;
  overflow-x: hidden;
  height: 100%;
  text-align: center;
}
.setupItems {
  display: grid;
  grid-column-gap: 1vw;
  grid-row-gap: 1vw;
  grid-template-columns: 25vw 25vw 25vw 25vw 0px;
  padding-bottom: 2vw;
}
.setupLeftColumn {
  grid-column: 2;
}
.setupRightColumns {
  grid-column: 3;
}
.setupCenterColumns {
  grid-column-start: 2;
  grid-column-end: 4;
}
.setupFullWidth {
  grid-column-start: 1;
  grid-column-end: 5;
}
.setupHintText {
  font-size: 1.5vw;
}

.fullSize {
  height: 100%;
  overflow-y: hidden;
  overflow-x: hidden;
}

.countdownViewLayout {
  display: grid;
  grid-template-rows: 25% auto 15% 5vw;
  height: 100%;
}
.countdownViewRowOne {
  grid-row: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}
.countdownViewRowTwo {
  grid-row: 2;
  display: flex;
  justify-content: center;
  align-items: center;
}
.countdownViewRowThree {
  grid-row: 3;
  display: flex;
  justify-content: center;
  align-items: center;
}
.countdownViewRowFour {
  grid-row: 4;
  display: grid;
  grid-template-columns: 10vw auto auto 10vw;
}

.countdownViewFooterColumnOne {
  grid-column: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}
.countdownViewFooterColumnTwo {
  grid-column: 2;
  display: flex;
  justify-content: center;
  align-items: center;
}
.countdownViewFooterColumnThree {
  grid-column: 3;
  display: flex;
  justify-content: center;
  align-items: center;
}
.countdownViewFooterColumnFour {
  grid-column: 4;
  display: flex;
  justify-content: center;
  align-items: center;
}

.logoHolderManu {
  padding-top: 0.35vw;
  width: 4vw;
}
.logoHolderBix {
  padding-top: 0.35vw;
  width: 5vw;
}

.colorModeToggle {
  position: absolute;
  top: 1vh;
  right: 1vw;
}

/* animations for reaching 0 */
.numbersRotationA {
  -webkit-animation: numberRotateA 2s linear 3;
  animation: numberRotateA 2s linear 3;
}
@-webkit-keyframes numberRotateA {
  0% {-webkit-transform: rotate(0);}
  100% {-webkit-transform: rotate(360deg);}
}
@keyframes numberRotateA {
  0% {transform: rotate(0);}
  100% {transform: rotate(360deg);}
}

.numbersRotationB {
  -webkit-animation: numberRotateB 2s linear 3;
  animation: numberRotateB 2s linear 3;
}
@-webkit-keyframes numberRotateB {
  0% {-webkit-transform: rotate(0);}
  100% {-webkit-transform: rotate(-360deg);}
}
@keyframes numberRotateB {
  0% {transform: rotate(0);}
  100% {transform: rotate(-360deg);}
}

.textPulsing {
  -webkit-animation: textPulse 2s ease 3;
  animation: textPulse 2s ease 3;
}
@-webkit-keyframes textPulse {
  0% {font-size: 5vw;}
  50% {font-size: 10vw;}
  100% {font-size: 5vw;}
}
@keyframes textPulse {
  0% {font-size: 5vw;}
  50% {font-size: 10vw;}
  100% {font-size: 5vw;}
}

/* svg styles */
.logoManuLineStyle {fill: none; stroke: var(--logoManuColor); stroke-miterlimit: 10; stroke-width: 10px;}

@media (prefers-color-scheme: dark) {
  :root {
    --bgGradientStart: rgb(12,12,12);
    --bgGradientEnd: rgb(34,34,34);
    --mainTextColor: #bbb;
    --cntElementBackground: #222;
    --cntNumberTextColor: #fff;
    --btnBackgroundColor: rgb(10,10,10);
    --btnDisabledTextColor: #444;
    --logoManuColor: #aaa;
  }
}
</style>
</head>
<body>
<div class="fullSize">
  <div id="setup" class="setupContainer">
    
    <div class="setupItems">
      <div class="setupFullWidth">
        <h1>Setup your countdown:</h1>
      </div>
      <div class="setupLeftColumn">
        <label for="cntdate">Date:</label><br/>
        <input id="cntdate" type="date" min="2021-04-16" placeholder="yyyy-mm-dd"/>
      </div>

      <div class="setupRightColumns">
        <label for="cnttime">Time:</label><br/>
        <input id="cnttime" type="time" placeholder="hh:mm"/>
      </div>

      <div class="setupLeftColumn">
        <label for="cntname">Project / Release Name:</label><br/>
        <input id="cntname" type="text" placeholder="next release" />
      </div>

      <div class="setupRightColumns">
        <label for="cntdone">Completed Message:</label><br/>
        <input id="cntdone" type="text" placeholder="Get it out!" />
      </div>
      <div class="setupCenterColumns">
        <label for="themeToggle">Toggle color theme:</label><br/>
        <button id="themeToggle" title="Toggle between light and dark theme">light 🌞 &nbsp; ↔️ &nbsp; 🌚 dark</button><br/>
        <span class="setupHintText">(Color theme settings are saved immediately)</span>
      </div>
      <div class="setupCenterColumns">
        &nbsp;
      </div>
      <div class="setupLeftColumn">
        <button id="setConfig" title="Start the countdown with the current settings">🚀 Start Countdown</button>
      </div>

      <div class="setupRightColumns">
        <button id="cancelConfig" title="Close settings and return to the running countdown">❎ Close</button>
      </div>
    </div>
  </div>

  <div id="countdown" class="countdownViewLayout">
    <div class="countdownViewRowOne">
      <h1>Time until <span id="projectname">???</span>:</h1>
    </div>
    <div class="countdownViewRowTwo">
      <div id="clockdiv">
        <div>
          <span class="days" id="day">?</span>
          <div class="smalltext">Days</div>
        </div>
        <div>
          <span class="hours" id="hour">?</span>
          <div class="smalltext">Hours</div>
        </div>
        <div>
          <span class="minutes" id="minute">?</span>
          <div class="smalltext">Minutes</div>
        </div>
        <div>
          <span class="seconds" id="second">?</span>
          <div class="smalltext">Seconds</div>
        </div>
      </div>
    </div>
    <div class="countdownViewRowThree">
      <p id="doneMessage" class="finishedText"></p>
    </div>
    <div class="countdownViewRowFour">
      <div class="countdownViewFooterColumnOne">
        <div class="logoHolderManu" title="coded by Manuel &quot;码奴&quot; Feller (GitHub @manuelfeller)">
          <a href="https://github.com/ManuelFeller/release-countdown" aria-label="Link to the source code repository of this web app">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 339.73 214.02">
              <line class="logoManuLineStyle" x1="15.34" y1="25.69" x2="15.34" y2="192.36"></line>
              <line class="logoManuLineStyle" x1="165.7" y1="25.69" x2="165.7" y2="102.8"></line>
              <line class="logoManuLineStyle" x1="158.78" y1="23.61" x2="99.82" y2="82.57"></line>
              <circle class="logoManuLineStyle" cx="15.34" cy="15.34" r="10.34"></circle>
              <circle class="logoManuLineStyle" cx="15.34" cy="198.68" r="10.34"></circle>
              <circle class="logoManuLineStyle" cx="165.7" cy="15.34" r="10.34"></circle>
              <circle class="logoManuLineStyle" cx="324.38" cy="15.34" r="10.34"></circle>
              <circle class="logoManuLineStyle" cx="91.84" cy="90.14" r="10.34"></circle>
              <circle class="logoManuLineStyle" cx="42.45" cy="40.78" r="10.34"></circle>
              <circle class="logoManuLineStyle" cx="66.96" cy="65.3" r="10.34"></circle>
              <line class="logoManuLineStyle" x1="49.77" y1="48.1" x2="59.65" y2="57.98"></line>
              <circle class="logoManuLineStyle" cx="165.7" cy="198.68" r="10.34"></circle>
              <circle class="logoManuLineStyle" cx="165.7" cy="113.14" r="10.34"></circle>
              <circle class="logoManuLineStyle" cx="165.7" cy="148.84" r="10.34"></circle>
              <line class="logoManuLineStyle" x1="165.7" y1="159.18" x2="165.7" y2="188.33"></line>
              <circle class="logoManuLineStyle" cx="217.78" cy="198.68" r="10.34"></circle>
              <polyline class="logoManuLineStyle" points="217.78 189.08 217.78 127.71 233.88 112.59 264.34 112.59"></polyline>
              <circle class="logoManuLineStyle" cx="274.01" cy="113.14" r="10.34"></circle>
              <polyline class="logoManuLineStyle" points="221.73 72.68 221.73 30.31 237.82 15.2 314.28 15.2"></polyline>
              <circle class="logoManuLineStyle" cx="221.73" cy="82.57" r="10.34"></circle>
              <path class="logoManuLineStyle" d="M16.22-12.3" transform="translate(-0.87 -1.18)"></path>
            </svg>
          </a>
        </div>
      </div>
      <div class="countdownViewFooterColumnTwo">
        <button id="restart" title="Show or change the setting for the current countdown">⚙️ Settings</button>
      </div>
      <div class="countdownViewFooterColumnThree">
        <button id="share" title="Generate a shareable link to this countdown">🔗 Share</button>
      </div>
      <div class="countdownViewFooterColumnFour">
        &nbsp; <!-- logo placeholder -->
      </div>
    </div>
  </div>
</div>
<script>

// define functions

const getCurrentColorMode = () => {
  const currentMode = localStorage.getItem('colorMode');
  if (currentMode === null) {
    // not set yet
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      // api is available and set to dark
      return 'dark';
    } else {
      // assume light mode
      return 'light';
    }
  } else {
    return currentMode;
  }
}

const toggleColorMode = () => {
  // check for local setting that is already there
  let currentMode = getCurrentColorMode();
  // check main text color to find out what mode is active
  if (currentMode === 'light') {
    // toggle to dark
    setColorMode(true);
    // persist current setting
    localStorage.setItem('colorMode', 'dark')
  } else {
    // toggle to light
    setColorMode(false);
    // persist current setting
    localStorage.setItem('colorMode', 'light')
  }
}

const setColorMode = (setToDark) => {
  if (setToDark) {
    // set to dark
    document.documentElement.style.setProperty('--bgGradientStart', 'rgb(12,12,12)');
    document.documentElement.style.setProperty('--bgGradientEnd', 'rgb(34,34,34)');
    document.documentElement.style.setProperty('--mainTextColor', '#bbb');
    document.documentElement.style.setProperty('--cntElementBackground', '#222');
    document.documentElement.style.setProperty('--cntNumberTextColor', '#fff');
    document.documentElement.style.setProperty('--btnBackgroundColor', 'rgb(10,10,10)');
    document.documentElement.style.setProperty('--btnDisabledTextColor', '#444');
    document.documentElement.style.setProperty('--logoManuColor', '#aaa');
  } else {
    // set to light
    document.documentElement.style.setProperty('--bgGradientStart', 'rgb(234,234,234)');
    document.documentElement.style.setProperty('--bgGradientEnd', 'rgb(210,210,210)');
    document.documentElement.style.setProperty('--mainTextColor', '#333');
    document.documentElement.style.setProperty('--cntElementBackground', '#eee');
    document.documentElement.style.setProperty('--cntNumberTextColor', '#fff');
    document.documentElement.style.setProperty('--btnBackgroundColor', '#ddd');
    document.documentElement.style.setProperty('--btnDisabledTextColor', '#888');
    document.documentElement.style.setProperty('--logoManuColor', '#000');
  }
}

const getEmptyConfigObject = () => {
  return {
    project: 'next release',
    doneMsg: 'Get it out!',
    year: new Date().getYear(),
    month: new Date().getMonth() + 1,
    day: new Date().getDate(),
    hour: new Date().getHours(),
    minute: 0,
  }
}

const addLeadingZeroIfNeeded = (value) => {
  if (value < 10) {
    return '0'.concat(value);
  } else {
    return value;
  }
}

const setConfigFromUrl = (url) => {
  let newConfig = getEmptyConfigObject();


  // project name
  let projName = url.searchParams.get('p');
  if (projName !== null) {
    newConfig.project = projName;
  }

  let cntDoneMessage = url.searchParams.get('msg');
  if (cntDoneMessage !== null) {
    newConfig.doneMsg = cntDoneMessage;
  }

  let year = url.searchParams.get('y');
  if (year !== null) {
    newConfig.year = year;
  }

  let month = url.searchParams.get('m');
  if (month !== null) {
    newConfig.month = month;
  }

  let day = url.searchParams.get('d');
  if (day !== null) {
    newConfig.day = day;
  }

  let hour = url.searchParams.get('h');
  if (hour !== null) {
    newConfig.hour = hour;
  }

  let minute = url.searchParams.get('min');
  if (minute !== null) {
    newConfig.minute = minute;
  }

  // save new time for deadline
  localStorage.setItem('config', JSON.stringify(newConfig));
  // remove set command from the url box
  window.location.href = window.location.origin.concat(window.location.pathname);
}

const stopFinishedAnimations = () => {
  document.getElementById("day").classList.remove('numbersRotationA');
  document.getElementById("hour").classList.remove('numbersRotationB');
  document.getElementById("minute").classList.remove('numbersRotationA');
  document.getElementById("second").classList.remove('numbersRotationB');
  document.getElementById("doneMessage").classList.remove('textPulsing');
}

const startFinishedAnimations = () => {
  document.getElementById("day").classList.add('numbersRotationA');
  document.getElementById("hour").classList.add('numbersRotationB');
  document.getElementById("minute").classList.add('numbersRotationA');
  document.getElementById("second").classList.add('numbersRotationB');
  document.getElementById("doneMessage").classList.add('textPulsing');
}

const initSetupUi = () => {
  stopFinishedAnimations();
  // check if there is a config we can return to
  let savedConfig = localStorage.getItem('config');
  if (savedConfig === null) { // no saved config yet
    // disable the back button
    document.getElementById("cancelConfig").disabled = true;
  } else {
    // load current target time
    document.getElementById("cancelConfig").disabled = false;
    const tmpConfig = JSON.parse(savedConfig);
    // generate date from UTC time setting
    const tmpDate = new Date(Date.UTC(tmpConfig.year, (tmpConfig.month - 1), tmpConfig.day, tmpConfig.hour, tmpConfig.minute));
    document.getElementById("cntname").value = tmpConfig.project;
    document.getElementById("cntdone").value = tmpConfig.doneMsg;
    // enter date adjusted to local timezone
    document.getElementById("cntdate").value = ''.concat(tmpDate.getFullYear(), '-', addLeadingZeroIfNeeded(tmpDate.getMonth() + 1), '-', addLeadingZeroIfNeeded(tmpDate.getDate()));
    document.getElementById("cnttime").value = ''.concat(addLeadingZeroIfNeeded(tmpDate.getHours()), ':', addLeadingZeroIfNeeded(tmpDate.getMinutes()));
  }
  // make sure countdown UI is hidden
  document.getElementById("countdown").style.display = 'none';
  // get date of today
  const isYear = new Date().getFullYear();
  const isMonth = addLeadingZeroIfNeeded(new Date().getUTCMonth() + 1);
  const isDay = addLeadingZeroIfNeeded(new Date().getDate());
  // set min date for the UI
  document.getElementById("cntdate").min = ''.concat(isYear, '-', isMonth, '-', isDay);
  // show UI
  document.getElementById("setup").style.display = null;
}

const closeSetupUi = () => {
  stopFinishedAnimations();
  document.getElementById("setup").style.display = 'none';
  document.getElementById("countdown").style.display = null;
}

const saveAndApplyConfig = () => {
  let errors = '';
  // read input fields
  const projectNameValue = document.getElementById("cntname").value;
  const finishedTextValue = document.getElementById("cntdone").value;
  const deadlineDateValue = document.getElementById("cntdate").value;
  const deadlineTimeValue = document.getElementById("cnttime").value;
  // init missing check
  let hasMissing = false;
  let tempTestConfig = getEmptyConfigObject();
  if (deadlineDateValue !== '') {
    const dateCheck = deadlineDateValue.match(/^\d{4}[./-]\d{2}[./-]\d{2}$/);
    if (dateCheck === null) {
      hasMissing = true;
      // add error text
      errors += '\n- wrong date format (use yyyy-mm-dd)';
    }
    else {
      // split date
      const dateParts = deadlineDateValue.split('-');
      // save date in config
      tempTestConfig.year = parseInt(dateParts[0]);
      tempTestConfig.month = parseInt(dateParts[1]);
      tempTestConfig.day = parseInt(dateParts[2]);
    }
  } else {
    hasMissing = true;
    // add error text
    errors += '\n- missing date';
  }

  if (deadlineTimeValue !== '') {
    const timeCheck = deadlineTimeValue.match(/^\d{2}[./:]\d{2}$/);
    if (timeCheck === null) {
      hasMissing = true;
      // add error text
      errors += '\n- wrong time format (use hh:mm)';
    } else {
      // split time
      const timeParts = deadlineTimeValue.split(':');
      // save time in config
      tempTestConfig.hour = parseInt(timeParts[0]);
      tempTestConfig.minute = parseInt(timeParts[1]);
    }
  } else {
    hasMissing = true;
    // add error text
    errors += '\n- missing time';
  }
  // if no error yet check if input can be combined to a valid date
  if (!hasMissing) {
    try {
      // tetsing for a valid date
      const testDate = new Date(Date.UTC(tempTestConfig.year, (tempTestConfig.month - 1), tempTestConfig.day, tempTestConfig.hour, tempTestConfig.minute));
      if (testDate.getUTCFullYear() != tempTestConfig.year
          || testDate.getUTCMonth() != (tempTestConfig.month - 1)
          || testDate.getUTCDate() != tempTestConfig.day
          || testDate.getUTCHours() != tempTestConfig.hour
          || testDate.getUTCMinutes() != tempTestConfig.minute
          ) { // date is not matching with what was entered by the user, so it is invalid (even if it may have been converted)
            hasMissing = true;
            // add error text
            errors += '\n- the input is not a valid date or time...';
      } else {
        // check if date is in the future
        console.log(new Date());
        console.log(testDate);
        if ((new Date()) >= testDate) {
          hasMissing = true;
            // add error text
            errors += '\n- the new countdown target time needs to be in the future...';
        }
      }
    } catch (err) {
      hasMissing = true;
      // add error text
      errors += '\n- the input is not a valid date or time...';
    }
  }

  // all data that is needed is available
  if (!hasMissing) {
    // optional values
    if (projectNameValue.trim() !== '') {
      tempTestConfig.project = projectNameValue;
    }
    if (finishedTextValue.trim() !== '') {
      tempTestConfig.doneMsg = finishedTextValue;
    }
    // do timezone conversion (create date form based on current timezone)
    const convertDate = new Date(tempTestConfig.year, (tempTestConfig.month - 1), tempTestConfig.day, tempTestConfig.hour, tempTestConfig.minute);
    const newConfig = getEmptyConfigObject();
    newConfig.project = tempTestConfig.project;
    newConfig.doneMsg = tempTestConfig.doneMsg;
    newConfig.year = convertDate.getUTCFullYear();
    newConfig.month = convertDate.getUTCMonth() + 1;
    newConfig.day = convertDate.getUTCDate();
    newConfig.hour = convertDate.getUTCHours();
    newConfig.minute = convertDate.getUTCMinutes();
    // save config
    localStorage.setItem('config', JSON.stringify(newConfig));
    // delete old timer
    clearInterval(intervalReference);
    // switch to countdown view
    document.getElementById("setup").style.display = 'none';
    startCountdown(newConfig);
  } else {
    alert('Invalid or missing inputs:' + errors);
  }
}

const startCountdown = (configObject) => {
  stopFinishedAnimations();
  document.getElementById("projectname").innerHTML = configObject.project;
  document.getElementById("doneMessage").style.visibility = 'hidden';
  document.getElementById("doneMessage").innerHTML = configObject.doneMsg;
  document.getElementById("countdown").style.display = null;
  const deadline = new Date(Date.UTC(configObject.year, (configObject.month - 1), configObject.day, configObject.hour, configObject.minute)).getTime();
  intervalReference = setInterval(function() {
    let now = new Date().getTime();
    let t = deadline - now;
    let days = Math.floor(t / (1000 * 60 * 60 * 24));
    let hours = Math.floor((t % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    let minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60));
    let seconds = Math.floor((t % (1000 * 60)) / 1000);
    document.getElementById("day").innerHTML = days ;
    document.getElementById("hour").innerHTML = hours;
    document.getElementById("minute").innerHTML = minutes;
    document.getElementById("second").innerHTML = seconds;
    if (t <= 0) {
      clearInterval(intervalReference);
      document.getElementById("doneMessage").style.visibility = 'visible';
      document.getElementById("day").innerHTML ='0';
      document.getElementById("hour").innerHTML ='0';
      document.getElementById("minute").innerHTML ='0';
      document.getElementById("second").innerHTML = '0';
      startFinishedAnimations();
    }
  }, 500);
}

const newCountdown = () => {
  document.getElementById("countdown").style.display = 'none';
  initSetupUi();
}

const shareCountdown = () => {
  const savedConfig = localStorage.getItem('config');
  if (savedConfig === null) {
    alert("There is no configured Countdown to share...");
  } else {
    const pageUrl = new URL(window.location);
    const configObject = JSON.parse(savedConfig);
    const shareUrl = window.location.origin.concat(
      window.location.pathname,
      '?a=set&',
      '&y=',
      encodeURIComponent(configObject.year),
      '&m=',
      encodeURIComponent(configObject.month),
      '&d=',
      encodeURIComponent(configObject.day),
      '&h=',
      encodeURIComponent(configObject.hour),
      '&min=',
      encodeURIComponent(configObject.minute),
      '&p=',
      encodeURIComponent(configObject.project),
      '&msg=',
      encodeURIComponent(configObject.doneMsg)
    );
    navigator.clipboard.writeText(shareUrl)
      .then(() => {
        alert('Share URL copied to clipboard...');
      })
      .catch(err => {
        alert('Error copying share URL to the clipboard: ', err);
      });
  }
}

// the actual script execution

// check if there is a preferred theme configured and set it
if (getCurrentColorMode() === 'dark') {
  setColorMode(true);
} else {
  setColorMode(false);
}
// init the only global element, the reference to the interval function
var intervalReference = null;
// hide both main UI views
document.getElementById("countdown").style.display = 'none';
document.getElementById("setup").style.display = 'none';
// init - bind the buttons to their functions
document.getElementById("themeToggle").addEventListener('click', toggleColorMode);
document.getElementById("setConfig").addEventListener('click', saveAndApplyConfig);
document.getElementById("cancelConfig").addEventListener('click', closeSetupUi);
document.getElementById("restart").addEventListener('click', newCountdown);
document.getElementById("share").addEventListener('click', shareCountdown);

// check if we should set the countdown config from a share URL
let url = new URL(window.location);
if (url.searchParams.get('a') === 'set') {
  // we have a share URL to apply, so let's do so
  setConfigFromUrl(url);
} else { // regular execution without share URL
  // (try to) load from local storage
  let savedConfig = localStorage.getItem('config');
  if (savedConfig === null) {
    // load the configuration UI
    initSetupUi();
  } else {
    // start the countdown based on the configuration
    startCountdown(JSON.parse(savedConfig));
  }
}

</script>
</body>
</html>
